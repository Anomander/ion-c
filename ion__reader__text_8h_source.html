<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Amazon Ion C: ionc/ionc/ion_reader_text.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>ionc/ionc/ion_reader_text.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright 2014-2016 Amazon.com, Inc. or its affiliates. All Rights Reserved.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;).</span>
<a name="l00005"></a>00005 <span class="comment"> * You may not use this file except in compliance with the License.</span>
<a name="l00006"></a>00006 <span class="comment"> * A copy of the License is located at:</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *     http://aws.amazon.com/apache2.0/</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * or in the &quot;license&quot; file accompanying this file. This file is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00011"></a>00011 <span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific</span>
<a name="l00012"></a>00012 <span class="comment"> * language governing permissions and limitations under the License.</span>
<a name="l00013"></a>00013 <span class="comment"> */</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">/*</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">   header to support the ion reader for text</span>
<a name="l00018"></a>00018 <span class="comment">   includes declarations for the ion sub byte values and the ion_read_text_* functions</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">    These are the structs to support the updated IonC text parser (i.e. the parser which understands the text serialization of an Ion octet stream.)</span>
<a name="l00021"></a>00021 <span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment">    The new text parser operates like this (more or less):</span>
<a name="l00023"></a>00023 <span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">        on next - </span>
<a name="l00025"></a>00025 <span class="comment">            scan until it has read enough characters (aka octets) to recognize the beginning and type of a value - return that type.</span>
<a name="l00026"></a>00026 <span class="comment">            set a mark in the stream on the first significant character, where the value has &quot;noise&quot; characters preceeding the actual</span>
<a name="l00027"></a>00027 <span class="comment">            value (such as &quot;{{&quot;, or &quot;&apos;&quot;, etc.) these will not be included.</span>
<a name="l00028"></a>00028 <span class="comment">            The type of the recognized value will be recorded and will be more specific than the Ion types (for example different</span>
<a name="l00029"></a>00029 <span class="comment">            types of string or symbol or int). </span>
<a name="l00030"></a>00030 <span class="comment">            </span>
<a name="l00031"></a>00031 <span class="comment">            // no: The maximum preserved lookahead (aka bytes required to be buffered) should be just 5 bytes (a year and the dash of a </span>
<a name="l00032"></a>00032 <span class="comment">            // no: timestamp to distinguish it from an int), all other preceeding characters are noise and do not need to be buffered.</span>
<a name="l00033"></a>00033 <span class="comment"></span>
<a name="l00034"></a>00034 <span class="comment">            In reality the preserved (buffered) lookahead can be arbitrary since Ion supports arbitrary numeric types. We have</span>
<a name="l00035"></a>00035 <span class="comment">            to read digits until we differentiate int from decimal from float. This can be any number of characters.</span>
<a name="l00036"></a>00036 <span class="comment"></span>
<a name="l00037"></a>00037 <span class="comment">            At this point we back the stream up to the beginning of the significant characters and return.</span>
<a name="l00038"></a>00038 <span class="comment"></span>
<a name="l00039"></a>00039 <span class="comment">            if the event the recognized value is a symbol we peek ahead to find the terminator. It the symbol is followed by a &quot;::&quot; we</span>
<a name="l00040"></a>00040 <span class="comment">            load the symbol onto our annotation list and repeat.</span>
<a name="l00041"></a>00041 <span class="comment"></span>
<a name="l00042"></a>00042 <span class="comment">            note that on following calls to next we may need to scan to the end of the current value before we start our real scan.</span>
<a name="l00043"></a>00043 <span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment">        on get&lt;value&gt; - </span>
<a name="l00045"></a>00045 <span class="comment">            read the characters until the appropriate terminator is encountered.</span>
<a name="l00046"></a>00046 <span class="comment">            for small values - all values of than string, blob, clob or containers - we buffer the bytes and then convert (do we really have to?)</span>
<a name="l00047"></a>00047 <span class="comment">            for blob, clob and string - we copy and convert in one pass.</span>
<a name="l00048"></a>00048 <span class="comment"></span>
<a name="l00049"></a>00049 <span class="comment">    If the user calls for the length of some value we can check for some specialized conditions (if we want to). In particular non-ascii</span>
<a name="l00050"></a>00050 <span class="comment">    characters, including escaped characters. If we have a string or symbol or clob with all ascii characters we can byte copy when the</span>
<a name="l00051"></a>00051 <span class="comment">    user chooses to read.</span>
<a name="l00052"></a>00052 <span class="comment"></span>
<a name="l00053"></a>00053 <span class="comment">    After a &quot;get length&quot; we also know the end of the value and can skip the scan value in favor of a straight forward seek.</span>
<a name="l00054"></a>00054 <span class="comment"></span>
<a name="l00055"></a>00055 <span class="comment"></span>
<a name="l00056"></a>00056 <span class="comment">#define TID_NULL       0    </span>
<a name="l00057"></a>00057 <span class="comment">        TID_NULL         &quot;null&quot; ( &quot;.&quot; ( &quot;null&quot;, &quot;bool&quot;, &quot;int&quot;, &quot;float&quot;, &quot;decimal&quot;, &quot;timestamp&quot;, &quot;symbol&quot;, &quot;string&quot;, &quot;clob&quot;, &quot;blob&quot;, &quot;list&quot;, &quot;sexp&quot;, &quot;struct&quot; ) )@</span>
<a name="l00058"></a>00058 <span class="comment">#define TID_BOOL       1  </span>
<a name="l00059"></a>00059 <span class="comment">        TID_BOOL         &quot;true&quot; | &quot;false&quot;</span>
<a name="l00060"></a>00060 <span class="comment">#define TID_INT    2    </span>
<a name="l00061"></a>00061 <span class="comment">        TID_POS_INT_1    [1-9][0-9]*</span>
<a name="l00062"></a>00062 <span class="comment">        TID_POS_INT_2    &quot;0x&quot; [0-9,a-f,A-F]+</span>
<a name="l00063"></a>00063 <span class="comment">        TID_NEG_INT_1    &quot;-&quot; [1-9][0-9]*</span>
<a name="l00064"></a>00064 <span class="comment">        TID_NEG_INT_2    &quot;-&quot; &quot;0x&quot;[0-9,a-f,A-F]+</span>
<a name="l00065"></a>00065 <span class="comment">#define TID_FLOAT      4    </span>
<a name="l00066"></a>00066 <span class="comment">        TID_FLOAT_1      &lt;int&gt; &quot;.&quot; &lt;positive int&gt; &quot;e&quot; ( &quot;+&quot; | &quot;-&quot; )@ &lt;positive int&gt;</span>
<a name="l00067"></a>00067 <span class="comment">        TID_FLOAT_2      &lt;int&gt; &quot;.&quot; &lt;positive int&gt; &quot;f&quot; ( &quot;+&quot; | &quot;-&quot; )@ &lt;positive int&gt;    // is this true? can we use e vs f to distiguish 32 bit vs 64 bit floating point values?</span>
<a name="l00068"></a>00068 <span class="comment">#define TID_DECIMAL    5    </span>
<a name="l00069"></a>00069 <span class="comment">        TID_DECIMAL_1    &lt;int&gt; &quot;.&quot; &lt;positive int&gt; </span>
<a name="l00070"></a>00070 <span class="comment">        TID_DECIMAL_2    &lt;int&gt; &quot;.&quot; &lt;positive int&gt; &quot;d&quot; ( &quot;+&quot; | &quot;-&quot; )@ &lt;positive int&gt;</span>
<a name="l00071"></a>00071 <span class="comment">#define TID_TIMESTAMP  6   </span>
<a name="l00072"></a>00072 <span class="comment">        TID_TIMESTAMP    &lt;year&gt; &quot;-&quot; &lt;month&gt; &quot;-&quot; &lt;day&gt; &quot;T&quot; ( &lt;hrs&gt; &quot;:&quot; &lt;min&gt; ( &quot;:&quot; &lt;whole secs&gt; ( &quot;.&quot; &lt;fractional secs&gt; )@ )@ )@ ( &quot;z&quot; | &quot;Z&quot; | (( &quot;+&quot; | &quot;-&quot; ) &lt;hrs&gt; ( &quot;:&quot; &lt;mins&gt; )@ ))</span>
<a name="l00073"></a>00073 <span class="comment">#define TID_SYMBOL     7    </span>
<a name="l00074"></a>00074 <span class="comment">        TID_SYMBOL_1     &quot;\&apos;&quot; &lt;string contents&gt; &quot;\&apos;&quot;</span>
<a name="l00075"></a>00075 <span class="comment">        TID_SYMBOL_2     [a-z,A-Z][a-z,A-Z,0-9]*</span>
<a name="l00076"></a>00076 <span class="comment">        TID_SYMBOL_3     &lt;op character&gt;+</span>
<a name="l00077"></a>00077 <span class="comment">#define TID_STRING     8    </span>
<a name="l00078"></a>00078 <span class="comment">        TID_STRING_1      &quot;\&quot;&quot; &lt;string contents&gt; &quot;\&quot;&quot;</span>
<a name="l00079"></a>00079 <span class="comment">        TID_STRING_2      &quot;\&apos;\&apos;\&apos;&quot; &lt;string contents&gt; &quot;\&apos;\&apos;\&apos;&quot; ( &lt;WS&gt; &quot;\&apos;\&apos;\&apos;&quot; &lt;string contents&gt; &quot;\&apos;\&apos;\&apos;&quot; )+</span>
<a name="l00080"></a>00080 <span class="comment">#define TID_CLOB       9</span>
<a name="l00081"></a>00081 <span class="comment">        TID_CLOB_1        &quot;{{&quot; &lt;WS&gt; &lt;string_1&gt; &lt;WS&gt; &quot;}}&quot;</span>
<a name="l00082"></a>00082 <span class="comment">        TID_CLOB_2        &quot;{{&quot; &lt;WS&gt; &lt;string_2&gt; &lt;WS&gt; &quot;}}&quot;</span>
<a name="l00083"></a>00083 <span class="comment">#define TID_BLOB      10    </span>
<a name="l00084"></a>00084 <span class="comment">        TID_BLOB          &quot;{{&quot; &lt;WS&gt; &lt;base64 contents&gt; &lt;WS&gt; &quot;}}&quot;</span>
<a name="l00085"></a>00085 <span class="comment">#define TID_LIST      11    </span>
<a name="l00086"></a>00086 <span class="comment">        TID_LIST          &quot;[&quot; ( &lt;WS&gt; &lt;value&gt; ( &lt;WS&gt; &quot;,&quot; &lt;WS&gt; &lt;value&gt; )@ ( &lt;WS&gt; &quot;,&quot; )@ )@ &lt;WS&gt; &quot;]&quot;</span>
<a name="l00087"></a>00087 <span class="comment">#define TID_SEXP      12    </span>
<a name="l00088"></a>00088 <span class="comment">        TID_SEXP          &quot;(&quot; ( &lt;WS&gt; ( &lt;value&gt; | &lt;symbol_3&gt; ) )@ &lt;WS&gt; &quot;)&quot;</span>
<a name="l00089"></a>00089 <span class="comment">#define TID_STRUCT    13    </span>
<a name="l00090"></a>00090 <span class="comment">        TID_STRUCT        &quot;{&quot; ( &lt;WS&gt; &lt;field&gt; ( &lt;WS&gt; &quot;,&quot; &lt;WS&gt; &lt;field&gt; )@ ( &lt;WS&gt; &quot;,&quot; )@ )@ &lt;WS&gt; &quot;}&quot;</span>
<a name="l00091"></a>00091 <span class="comment">#define TID_UTA       14    ( &lt;symbol_1&gt; | &lt;symbol_2&gt; ) &lt;WS&gt; &quot;::&quot;</span>
<a name="l00092"></a>00092 <span class="comment"></span>
<a name="l00093"></a>00093 <span class="comment">WS                 &apos;\0&apos; &apos;\t&apos; &apos; &apos; &lt;newline_1&gt; &lt;newline_2&gt; &lt;newline_3&gt; &lt;comment_1&gt; &lt;comment_2&gt;</span>
<a name="l00094"></a>00094 <span class="comment">newline_1          &apos;\n&apos; </span>
<a name="l00095"></a>00095 <span class="comment">newline_2          &apos;\r&apos; &apos;\n&apos;</span>
<a name="l00096"></a>00096 <span class="comment">newline_3          &apos;\r&apos;</span>
<a name="l00097"></a>00097 <span class="comment">comment_1          &apos;\\&apos; &apos;\\&apos; [ non-white space ] (newline_1 | newline_2 | newline_3 )</span>
<a name="l00098"></a>00098 <span class="comment">comment_2          &apos;\\&apos; &apos;*&apos; &lt;any character&gt; &apos;*&apos; &apos;\\&apos;</span>
<a name="l00099"></a>00099 <span class="comment">value              ( &lt;uta&gt; )@ ( NULL | BOOL | INT | FLOAT | DECIMAL | TIMESTAMP | SYMBOL | STRING | CLOB | BLOB  | LIST | SEXP | STRUCT )</span>
<a name="l00100"></a>00100 <span class="comment">field              ( &lt;symbol_1&gt; | &lt;symbol_2&gt; ) &quot;:&quot; &lt;value&gt;</span>
<a name="l00101"></a>00101 <span class="comment">string contents    ( &lt;utf8 char&gt; | &lt;esc char&gt; )@</span>
<a name="l00102"></a>00102 <span class="comment">op characters      ( &apos;!&apos;=33, &apos;#&apos;=35, %&apos;=37, &apos;&amp;&apos;=38, &apos;*&apos;=42, &apos;+&apos;=43, -&apos;=45, &apos;.&apos;=46, &apos;/&apos;=47, &apos;;&apos;=59, &apos;&lt;&apos;=60, &apos;=&apos;=61, &gt;&apos;=62, &apos;?&apos;=63, &apos;@&apos;=64, &apos;^&apos;=94, &apos;`&apos;=96, &apos;|&apos;=124, &apos;~&apos;=126 )</span>
<a name="l00103"></a>00103 <span class="comment">year               [0-9] [0-9] [0-9] [0-9] </span>
<a name="l00104"></a>00104 <span class="comment">month              [0-1]@ [0-9] </span>
<a name="l00105"></a>00105 <span class="comment">day                [0-3]@ [0-9] </span>
<a name="l00106"></a>00106 <span class="comment">hrs                [0-5]@ [0-9] </span>
<a name="l00107"></a>00107 <span class="comment">min                [0-5]@ [0-9] </span>
<a name="l00108"></a>00108 <span class="comment">whole secs         [0-5]@ [0-9] </span>
<a name="l00109"></a>00109 <span class="comment">fractional secs    [0-9]+</span>
<a name="l00110"></a>00110 <span class="comment">base64 contents    ( ( &lt;base64char&gt; &lt;base64char&gt; &lt;base64char&gt; &lt;base64char&gt; )@ ( ( &lt;base64char&gt; &lt;base64char&gt; &lt;base64char&gt; &quot;=&quot; ) | ( &lt;base64char&gt; &lt;base64char&gt; &quot;==&quot; ) | ( &lt;base64char&gt; &quot;===&quot; ) )@ )</span>
<a name="l00111"></a>00111 <span class="comment">base64char         [a-z,A-Z,0-9,&apos;\&apos;,&apos;+&apos;]</span>
<a name="l00112"></a>00112 <span class="comment"></span>
<a name="l00113"></a>00113 <span class="comment">*/</span>
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="comment">/*</span>
<a name="l00116"></a>00116 <span class="comment">    parser states:</span>
<a name="l00117"></a>00117 <span class="comment"></span>
<a name="l00118"></a>00118 <span class="comment">        before uta</span>
<a name="l00119"></a>00119 <span class="comment">        before value</span>
<a name="l00120"></a>00120 <span class="comment"></span>
<a name="l00121"></a>00121 <span class="comment">        before sexp uta</span>
<a name="l00122"></a>00122 <span class="comment">        before sexp value</span>
<a name="l00123"></a>00123 <span class="comment"></span>
<a name="l00124"></a>00124 <span class="comment">        before list uta</span>
<a name="l00125"></a>00125 <span class="comment">        before list value</span>
<a name="l00126"></a>00126 <span class="comment"></span>
<a name="l00127"></a>00127 <span class="comment">        before struct fieldname</span>
<a name="l00128"></a>00128 <span class="comment">        before struct uta</span>
<a name="l00129"></a>00129 <span class="comment">        before struct value</span>
<a name="l00130"></a>00130 <span class="comment"></span>
<a name="l00131"></a>00131 <span class="comment">        in value</span>
<a name="l00132"></a>00132 <span class="comment">        in sexp value</span>
<a name="l00133"></a>00133 <span class="comment">        in list value</span>
<a name="l00134"></a>00134 <span class="comment">        in struct value</span>
<a name="l00135"></a>00135 <span class="comment"></span>
<a name="l00136"></a>00136 <span class="comment">        after value</span>
<a name="l00137"></a>00137 <span class="comment">        after sexp value</span>
<a name="l00138"></a>00138 <span class="comment">        after list value</span>
<a name="l00139"></a>00139 <span class="comment">        after struct value</span>
<a name="l00140"></a>00140 <span class="comment">        </span>
<a name="l00141"></a>00141 <span class="comment">        error</span>
<a name="l00142"></a>00142 <span class="comment">        eof</span>
<a name="l00143"></a>00143 <span class="comment"></span>
<a name="l00144"></a>00144 <span class="comment">    state transitions:</span>
<a name="l00145"></a>00145 <span class="comment"></span>
<a name="l00146"></a>00146 <span class="comment">    START -&gt; before uta(DATAGRAM)</span>
<a name="l00147"></a>00147 <span class="comment"></span>
<a name="l00148"></a>00148 <span class="comment">    before fieldname(C):                                            // C is container (and it better be STRUCT)</span>
<a name="l00149"></a>00149 <span class="comment">        next():</span>
<a name="l00150"></a>00150 <span class="comment">            &lt;fieldname&gt;     -&gt; [save fieldname], before uta(C)</span>
<a name="l00151"></a>00151 <span class="comment">            &quot;}&quot;             -&gt; after container                      : if C == STRUCT else error</span>
<a name="l00152"></a>00152 <span class="comment">            &lt;eof&gt;           -&gt; eof</span>
<a name="l00153"></a>00153 <span class="comment"></span>
<a name="l00154"></a>00154 <span class="comment">    before uta(C):                                                  // C is container</span>
<a name="l00155"></a>00155 <span class="comment">        next():</span>
<a name="l00156"></a>00156 <span class="comment">            &lt;fieldname&gt;     -&gt; error</span>
<a name="l00157"></a>00157 <span class="comment">            &lt;uta&gt;           -&gt; [save uta], before uta(C)</span>
<a name="l00158"></a>00158 <span class="comment">            &lt;value&gt;         -&gt; before value(C)</span>
<a name="l00159"></a>00159 <span class="comment">            &quot;)&quot;             -&gt; after container                      : if C == SEXP else error</span>
<a name="l00160"></a>00160 <span class="comment">            &quot;]&quot;             -&gt; after container                      : if C == LIST else error</span>
<a name="l00161"></a>00161 <span class="comment">            &lt;eof&gt;           -&gt; eof</span>
<a name="l00162"></a>00162 <span class="comment"></span>
<a name="l00163"></a>00163 <span class="comment">    before value(C):</span>
<a name="l00164"></a>00164 <span class="comment">        skip value()    -&gt; [scan to end of value], after value(C)</span>
<a name="l00165"></a>00165 <span class="comment">        read partial()  -&gt; [read bytes], in value(C)                : if value is string, clob or blob</span>
<a name="l00166"></a>00166 <span class="comment">        read full()     -&gt; [read bytes], after value(C)             : if value is scalar</span>
<a name="l00167"></a>00167 <span class="comment">        &quot;{&quot;             -&gt; [push(C)], before value(STRUCT)</span>
<a name="l00168"></a>00168 <span class="comment">        &quot;(&quot;             -&gt; [push(C)], before value(SEXP)</span>
<a name="l00169"></a>00169 <span class="comment">        &quot;[&quot;             -&gt; [push(C)], before value(LIST)</span>
<a name="l00170"></a>00170 <span class="comment">        &lt;eof&gt;           -&gt; eof</span>
<a name="l00171"></a>00171 <span class="comment"></span>
<a name="l00172"></a>00172 <span class="comment">    in value(C):</span>
<a name="l00173"></a>00173 <span class="comment">        read partial()  -&gt; in value(C)</span>
<a name="l00174"></a>00174 <span class="comment">        &lt;eov&gt;           -&gt; after value(C)</span>
<a name="l00175"></a>00175 <span class="comment"></span>
<a name="l00176"></a>00176 <span class="comment">    before comma(C):</span>
<a name="l00177"></a>00177 <span class="comment">        &quot;,&quot;             -&gt; before uta(C)</span>
<a name="l00178"></a>00178 <span class="comment">        &quot;}&quot;             -&gt; </span>
<a name="l00179"></a>00179 <span class="comment">        &quot;]&quot;             -&gt; </span>
<a name="l00180"></a>00180 <span class="comment"></span>
<a name="l00181"></a>00181 <span class="comment">    after value:</span>
<a name="l00182"></a>00182 <span class="comment">        &quot;}&quot;             -&gt; [P = pop()]</span>
<a name="l00183"></a>00183 <span class="comment">        &quot;)&quot;</span>
<a name="l00184"></a>00184 <span class="comment">        &quot;]&quot;</span>
<a name="l00185"></a>00185 <span class="comment">        &quot;,&quot;</span>
<a name="l00186"></a>00186 <span class="comment">        -&gt; before uta</span>
<a name="l00187"></a>00187 <span class="comment"></span>
<a name="l00188"></a>00188 <span class="comment">    after container:</span>
<a name="l00189"></a>00189 <span class="comment">        step out()      -&gt; [P = pop()], after value(C)</span>
<a name="l00190"></a>00190 <span class="comment">        next()          -&gt; [return &lt;eof&gt;], after container</span>
<a name="l00191"></a>00191 <span class="comment"></span>
<a name="l00192"></a>00192 <span class="comment">    error:</span>
<a name="l00193"></a>00193 <span class="comment">    eof:</span>
<a name="l00194"></a>00194 <span class="comment">        DONE - we do let the caller reset the reader (as in seek)</span>
<a name="l00195"></a>00195 <span class="comment">*/</span>
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="preprocessor">#ifndef ION_READER_TEXT_H_</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span><span class="preprocessor">#define ION_READER_TEXT_H_</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span>
<a name="l00201"></a>00201 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
<a name="l00203"></a>00203 <span class="preprocessor">#endif</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span>
<a name="l00217"></a>00217 <span class="preprocessor">#define IPS_ERROR               -2</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span><span class="preprocessor">#define IPS_EOF                 -1</span>
<a name="l00219"></a>00219 <span class="preprocessor"></span><span class="preprocessor">#define IPS_NONE                 0</span>
<a name="l00220"></a>00220 <span class="preprocessor"></span><span class="preprocessor">#define IPS_BEFORE_UTA           1 </span><span class="comment">/* this is before value is recognized */</span>
<a name="l00221"></a>00221 <span class="preprocessor">#define IPS_BEFORE_FIELDNAME     2 </span><span class="comment">/* this is before value is recognized */</span>
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 <span class="preprocessor">#define IPS_BEFORE_SCALAR        3 </span><span class="comment">/* this is value recognized, not read */</span>
<a name="l00224"></a>00224 <span class="preprocessor">#define IPS_BEFORE_CONTAINER     4 </span><span class="comment">/* this is value recognized, not read */</span>
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="preprocessor">#define IPS_IN_VALUE             5 </span><span class="comment">/* this is value recognized, partially read, including containers */</span>
<a name="l00227"></a>00227 <span class="preprocessor">#define IPS_AFTER_VALUE          6 </span><span class="comment">/* this is after the value is read, just past last character of value (including punctuation if there is any) */</span>
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 <span class="preprocessor">#define IPS_AFTER_COMMA          7</span>
<a name="l00230"></a>00230 <span class="preprocessor"></span>
<a name="l00231"></a>00231 <span class="comment">// these tell us where the scanner value is located</span>
<a name="l00232"></a>00232 <span class="preprocessor">#define SVL_NONE                 0</span>
<a name="l00233"></a>00233 <span class="preprocessor"></span><span class="preprocessor">#define SVL_VALUE_IMAGE          1</span>
<a name="l00234"></a>00234 <span class="preprocessor"></span><span class="preprocessor">#define SVL_IN_STREAM            2</span>
<a name="l00235"></a>00235 <span class="preprocessor"></span><span class="preprocessor">#define SVL_SUB_ION_VALUE        3</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="comment">// Follow Container Flags, also marks the various nulls</span>
<a name="l00239"></a>00239 <span class="preprocessor">#define FCF_none         0x0000</span>
<a name="l00240"></a>00240 <span class="preprocessor"></span><span class="comment">// This is a valid token to see following a value in a:</span>
<a name="l00241"></a>00241 <span class="preprocessor">#define FCF_DATAGRAM     0x0001</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span><span class="preprocessor">#define FCF_SEXP         0x0002</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span><span class="preprocessor">#define FCF_LIST         0x0004</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span><span class="preprocessor">#define FCF_STRUCT       0x0008</span>
<a name="l00245"></a>00245 <span class="preprocessor"></span>
<a name="l00246"></a>00246 <span class="comment">// this is a form of NULL</span>
<a name="l00247"></a>00247 <span class="preprocessor">#define FCF_IS_NULL      0x0010</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span>
<a name="l00249"></a>00249 <span class="comment">// this is a form of a number (int float decimal)</span>
<a name="l00250"></a>00250 <span class="preprocessor">#define FCF_IS_NUMBER    0x0020</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>
<a name="l00252"></a>00252 <span class="comment">// this is an intermediate token seen at the end of </span>
<a name="l00253"></a>00253 <span class="preprocessor">#define FCF_CLOSE_PREV   0x0040</span>
<a name="l00254"></a>00254 <span class="preprocessor"></span>
<a name="l00255"></a>00255 <span class="comment">// this is a container</span>
<a name="l00256"></a>00256 <span class="preprocessor">#define FCF_IS_CONTAINER 0x0100</span>
<a name="l00257"></a>00257 <span class="preprocessor"></span>
<a name="l00258"></a>00258 <span class="comment">// numeric stop characters</span>
<a name="l00259"></a>00259 <span class="preprocessor">#define NUMERIC_STOP_CHARACTERS &quot;{}[](),\&quot;\&apos; \t\n\r&quot;</span>
<a name="l00260"></a>00260 <span class="preprocessor"></span>
<a name="l00261"></a>00261 <span class="preprocessor">#define IST_FOLLOW_STATE( iii )     ((iii)-&gt;follow_state)</span>
<a name="l00262"></a>00262 <span class="preprocessor"></span><span class="preprocessor">#define IST_BASE_TYPE( iii )        ((iii)-&gt;base_type)</span>
<a name="l00263"></a>00263 <span class="preprocessor"></span><span class="preprocessor">#define IST_FLAG_IS_ON( iii, fff )  ( ((iii)-&gt;flags &amp; (fff)) != 0 )</span>
<a name="l00264"></a>00264 <span class="preprocessor"></span>
<a name="l00265"></a>00265 <span class="comment">// provide declarations for the ion sub type &quot;enums&quot;</span>
<a name="l00266"></a>00266 <span class="preprocessor">#define IST_RECORD( NAME, TTT, STATE, FLAGS )  extern ION_SUB_TYPE  NAME ;</span>
<a name="l00267"></a>00267 <span class="preprocessor"></span><span class="preprocessor">#include &quot;ion_sub_type_records.h&quot;</span>
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 <span class="preprocessor">#include &quot;ion_scanner.h&quot;</span>
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 <span class="comment">//</span>
<a name="l00274"></a>00274 <span class="comment">// ion reader (for) text functions</span>
<a name="l00275"></a>00275 <span class="comment">//</span>
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="comment">// reader level functions</span>
<a name="l00279"></a>00279 iERR _ion_reader_text_open                      (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader);
<a name="l00280"></a>00280 iERR _ion_reader_text_open_alloc_buffered_string(<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, SIZE len, <a class="code" href="struct__ion__string.html">ION_STRING</a> *p_string, BYTE **p_buf, SIZE *p_buf_len);
<a name="l00281"></a>00281 iERR _ion_reader_text_reset                     (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, ION_TYPE parent_tid, POSITION local_end);
<a name="l00282"></a>00282 iERR _ion_reader_text_reset_value               (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader);
<a name="l00283"></a>00283 iERR _ion_reader_text_set_symbol_table          (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <a class="code" href="struct__ion__symbol__table.html">ION_SYMBOL_TABLE</a> *symtab);
<a name="l00284"></a>00284 iERR _ion_reader_text_close                     (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="comment">// support for &quot;next&quot; functions</span>
<a name="l00287"></a>00287 iERR _ion_reader_text_next                      (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, ION_TYPE *p_value_type);
<a name="l00288"></a>00288 iERR _ion_reader_text_load_fieldname            (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <a class="code" href="struct__ion__sub__type.html">ION_SUB_TYPE</a> *p_ist);
<a name="l00289"></a>00289 iERR _ion_reader_text_load_utas                 (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <a class="code" href="struct__ion__sub__type.html">ION_SUB_TYPE</a> *p_ist);
<a name="l00290"></a>00290 iERR _ion_reader_text_check_for_system_values_to_skip_or_process(<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <a class="code" href="struct__ion__sub__type.html">ION_SUB_TYPE</a> ist, BOOL *p_is_system_value );
<a name="l00291"></a>00291 iERR _ion_reader_text_check_follow_token        (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 iERR _ion_reader_text_step_in                   (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader);
<a name="l00294"></a>00294 iERR _ion_reader_text_step_out                  (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 <span class="comment">// various forms of &quot;getters&quot; to get information about the readers</span>
<a name="l00297"></a>00297 <span class="comment">// current state, in particular the metadata about the current value</span>
<a name="l00298"></a>00298 iERR _ion_reader_text_get_depth                 (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, SIZE *p_depth);
<a name="l00299"></a>00299 iERR _ion_reader_text_get_type                  (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, ION_TYPE *p_value_type);
<a name="l00300"></a>00300 iERR _ion_reader_text_is_null                   (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, BOOL *p_is_null);
<a name="l00301"></a>00301 iERR _ion_reader_text_has_any_annotations       (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, BOOL *p_has_annotations);
<a name="l00302"></a>00302 iERR _ion_reader_text_has_annotation            (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <a class="code" href="struct__ion__string.html">ION_STRING</a> *annotation, BOOL *p_annotation_found);
<a name="l00303"></a>00303 iERR _ion_reader_text_get_annotation_count      (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, int32_t *p_count);
<a name="l00304"></a>00304 iERR _ion_reader_text_get_an_annotation         (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, int32_t idx, <a class="code" href="struct__ion__string.html">ION_STRING</a> *p_str);
<a name="l00305"></a>00305 iERR _ion_reader_text_get_field_name            (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <a class="code" href="struct__ion__string.html">ION_STRING</a> **p_pstr);
<a name="l00306"></a>00306 iERR _ion_reader_text_get_symbol_table          (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <a class="code" href="struct__ion__symbol__table.html">ION_SYMBOL_TABLE</a> **p_return);
<a name="l00307"></a>00307 iERR _ion_reader_text_get_field_sid             (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, SID *p_sid);
<a name="l00308"></a>00308 iERR _ion_reader_text_get_annotations           (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <a class="code" href="struct__ion__string.html">ION_STRING</a> *p_strs, SIZE max_count, SIZE *p_count);
<a name="l00309"></a>00309 iERR _ion_reader_text_get_annotation_sids       (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, SID *p_sids, SIZE max_count, SIZE *p_count);
<a name="l00310"></a>00310 iERR _ion_reader_text_get_value_offset          (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, POSITION *p_offset);
<a name="l00311"></a>00311 iERR _ion_reader_text_get_value_length          (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, SIZE *p_length);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 <span class="comment">// value getting functions</span>
<a name="l00314"></a>00314 iERR _ion_reader_text_read_null                 (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, ION_TYPE *p_value);
<a name="l00315"></a>00315 iERR _ion_reader_text_read_bool                 (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, BOOL *p_value);
<a name="l00316"></a>00316 iERR _ion_reader_text_read_mixed_int_helper     (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader);
<a name="l00317"></a>00317 iERR _ion_reader_text_read_int32                (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, int32_t *p_value);
<a name="l00318"></a>00318 iERR _ion_reader_text_read_int64                (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, int64_t *p_value);
<a name="l00319"></a>00319 iERR _ion_reader_text_read_ion_int_helper       (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <a class="code" href="struct__ion__int.html">ION_INT</a> *p_value);
<a name="l00320"></a>00320 iERR _ion_reader_text_read_double               (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <span class="keywordtype">double</span> *p_value);
<a name="l00321"></a>00321 <span class="comment">//iERR _ion_reader_text_read_float32              (ION_READER *preader, float *p_value);</span>
<a name="l00322"></a>00322 iERR _ion_reader_text_read_decimal              (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, decQuad *p_value);
<a name="l00323"></a>00323 iERR _ion_reader_text_read_timestamp            (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <a class="code" href="struct__ion__timestamp.html">ION_TIMESTAMP</a> *p_value);
<a name="l00324"></a>00324 iERR _ion_reader_text_read_symbol_sid           (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, SID *p_value);
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 <span class="comment">// get string functions, these work over value of type string or type symbol</span>
<a name="l00327"></a>00327 <span class="comment">// get length FORCES the value to read into the value_image buffer (which may not be desirable)</span>
<a name="l00328"></a>00328 iERR _ion_reader_text_get_string_length         (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, SIZE *p_length);
<a name="l00329"></a>00329 iERR _ion_reader_text_read_string               (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, <a class="code" href="struct__ion__string.html">ION_STRING</a> *p_user_str);
<a name="l00330"></a>00330 iERR _ion_reader_text_load_string_in_value_buffer(<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader);
<a name="l00331"></a>00331 iERR _ion_reader_text_read_string_bytes         (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, BOOL accept_partial, BYTE *p_buf, SIZE buf_max, SIZE *p_length) ;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="comment">// get lob value functions, these work over value of type clob or type blob</span>
<a name="l00334"></a>00334 <span class="comment">// get lob size FORCES the value to read into the value_image buffer (which may not be desirable)</span>
<a name="l00335"></a>00335 iERR _ion_reader_text_get_lob_size              (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, SIZE *p_length);
<a name="l00336"></a>00336 iERR _ion_reader_text_read_lob_bytes            (<a class="code" href="struct__ion__reader.html">ION_READER</a> *preader, BOOL accept_partial, BYTE *p_buf, SIZE buf_max, SIZE *p_length) ;
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="keyword">enum</span> version_marker_result { SUCCESS = 0, ERROR = 1 };
<a name="l00339"></a>00339 <span class="keyword">enum</span> version_marker_result _ion_reader_text_parse_version_marker(<a class="code" href="struct__ion__string.html">ION_STRING</a>* version_marker, <span class="keywordtype">int</span>* major_version, <span class="keywordtype">int</span>* minor_version);
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00342"></a>00342 <span class="preprocessor"></span>}
<a name="l00343"></a>00343 <span class="preprocessor">#endif</span>
<a name="l00344"></a>00344 <span class="preprocessor"></span>
<a name="l00345"></a>00345 <span class="preprocessor">#endif</span>
<a name="l00346"></a>00346 <span class="preprocessor"></span>
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 30 Jun 2016 for Amazon Ion C by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
